{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { useProjectService } from '@/services/project.service';\n\n// 状态\n\nexport default {\n  __name: 'ProjectAdmin',\n  setup(__props) {\n    const projects = ref([]);\n    const showAddDialog = ref(false);\n    let isEditing = false;\n    const formRef = ref(null);\n    const formData = ref({\n      id: '',\n      name: '',\n      description: '',\n      startDate: '',\n      endDate: '',\n      status: 'notStarted'\n    });\n\n    // 路由、store和服务\n    const router = useRouter();\n    const store = useStore();\n    const projectService = useProjectService();\n\n    // 已移除未使用的projectList计算属性\n\n    // 生命周期\n    onMounted(async () => {\n      await loadProjects();\n    });\n\n    // 加载项目列表\n    const loadProjects = async () => {\n      try {\n        const data = await projectService.getAllProjects();\n        projects.value = data;\n        // 更新Vuex store\n        store.dispatch('setProjects', data);\n      } catch (error) {\n        console.error('加载项目列表失败:', error);\n        this.$message.error('加载项目列表失败');\n      }\n    };\n\n    // 查看项目\n    const viewProject = id => {\n      router.push({\n        name: 'projectDetail',\n        params: {\n          id\n        }\n      });\n    };\n\n    // 编辑项目\n    const editProject = project => {\n      isEditing = true;\n      formData.value = {\n        ...project\n      };\n      showAddDialog.value = true;\n    };\n\n    // 删除项目\n    const deleteProject = async id => {\n      try {\n        await projectService.deleteProject(id);\n        // 更新本地数据\n        projects.value = projects.value.filter(project => project.id !== id);\n        // 更新Vuex store\n        store.dispatch('deleteProjectById', id);\n        this.$message.success('项目删除成功');\n      } catch (error) {\n        console.error('删除项目失败:', error);\n        this.$message.error('删除项目失败');\n      }\n    };\n\n    // 提交表单\n    const submitForm = async () => {\n      try {\n        await formRef.value.validate();\n        if (isEditing) {\n          // 编辑项目\n          await projectService.updateProject(formData.value.id, formData.value);\n          // 更新本地数据\n          const index = projects.value.findIndex(project => project.id === formData.value.id);\n          if (index !== -1) {\n            projects.value[index] = {\n              ...formData.value\n            };\n          }\n          // 更新Vuex store\n          store.dispatch('updateProjectById', {\n            id: formData.value.id,\n            updatedData: formData.value\n          });\n          this.$message.success('项目更新成功');\n        } else {\n          // 添加项目\n          const newProject = await projectService.createProject(formData.value);\n          // 更新本地数据\n          projects.value.push(newProject);\n          // 更新Vuex store\n          store.dispatch('addProject', newProject);\n          this.$message.success('项目添加成功');\n        }\n\n        // 关闭对话框\n        showAddDialog.value = false;\n        // 重置表单\n        resetForm();\n      } catch (error) {\n        console.error('提交表单失败:', error);\n        if (error.name === 'ValidationError') {\n          return;\n        }\n        this.$message.error('操作失败，请重试');\n      }\n    };\n\n    // 重置表单\n    const resetForm = () => {\n      formRef.value.resetFields();\n      formData.value = {\n        id: '',\n        name: '',\n        description: '',\n        startDate: '',\n        endDate: '',\n        status: 'notStarted'\n      };\n      isEditing = false;\n    };\n    return {\n      __sfc: true,\n      projects,\n      showAddDialog,\n      isEditing,\n      formRef,\n      formData,\n      router,\n      store,\n      projectService,\n      loadProjects,\n      viewProject,\n      editProject,\n      deleteProject,\n      submitForm,\n      resetForm\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","useStore","useProjectService","projects","showAddDialog","isEditing","formRef","formData","id","name","description","startDate","endDate","status","router","store","projectService","loadProjects","data","getAllProjects","value","dispatch","error","console","$message","viewProject","push","params","editProject","project","deleteProject","filter","success","submitForm","validate","updateProject","index","findIndex","updatedData","newProject","createProject","resetForm","resetFields"],"sources":["ProjectAdmin.vue"],"sourcesContent":["<template>\n  <div class=\"project-admin-container\">\n    <div class=\"header\">\n      <h2>项目管理</h2>\n      <button class=\"add-btn\" @click=\"showAddDialog = true\">添加项目</button>\n    </div>\n\n    <!-- 项目列表 -->\n    <div class=\"project-list\">\n      <el-table :data=\"projects\" style=\"width: 100%\">\n        <el-table-column prop=\"id\" label=\"项目ID\" width=\"80\"></el-table-column>\n        <el-table-column prop=\"name\" label=\"项目名称\" width=\"200\"></el-table-column>\n        <el-table-column prop=\"description\" label=\"项目描述\"></el-table-column>\n        <el-table-column prop=\"startDate\" label=\"开始日期\" width=\"120\"></el-table-column>\n        <el-table-column prop=\"endDate\" label=\"结束日期\" width=\"120\"></el-table-column>\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\"></el-table-column>\n        <el-table-column label=\"操作\" width=\"180\" fixed=\"right\">\n          <template #default=\"scope\">\n            <el-button size=\"small\" @click=\"viewProject(scope.row.id)\">查看</el-button>\n            <el-button size=\"small\" type=\"primary\" @click=\"editProject(scope.row)\">编辑</el-button>\n            <el-button size=\"small\" type=\"danger\" @click=\"deleteProject(scope.row.id)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n\n    <!-- 添加/编辑项目对话框 -->\n    <el-dialog v-model=\"showAddDialog\" :title=\"isEditing ? '编辑项目' : '添加项目'\" width=\"500px\">\n      <el-form :model=\"formData\" ref=\"formRef\" label-width=\"100px\">\n        <el-form-item label=\"项目名称\" prop=\"name\" :rules=\"[{ required: true, message: '请输入项目名称' }]\">\n          <el-input v-model=\"formData.name\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"项目描述\" prop=\"description\">\n          <el-input v-model=\"formData.description\" type=\"textarea\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"开始日期\" prop=\"startDate\" :rules=\"[{ required: true, message: '请选择开始日期' }]\">\n          <el-date-picker v-model=\"formData.startDate\" type=\"date\"></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"结束日期\" prop=\"endDate\" :rules=\"[{ required: true, message: '请选择结束日期' }]\">\n          <el-date-picker v-model=\"formData.endDate\" type=\"date\"></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"项目状态\" prop=\"status\">\n          <el-select v-model=\"formData.status\">\n            <el-option label=\"未开始\" value=\"notStarted\"></el-option>\n            <el-option label=\"进行中\" value=\"inProgress\"></el-option>\n            <el-option label=\"已完成\" value=\"completed\"></el-option>\n            <el-option label=\"已延期\" value=\"delayed\"></el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"showAddDialog = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitForm\">确认</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { useProjectService } from '@/services/project.service'\n\n// 状态\nconst projects = ref([])\nconst showAddDialog = ref(false)\nlet isEditing = false\nconst formRef = ref(null)\nconst formData = ref({\n  id: '',\n  name: '',\n  description: '',\n  startDate: '',\n  endDate: '',\n  status: 'notStarted'\n})\n\n// 路由、store和服务\nconst router = useRouter()\nconst store = useStore()\nconst projectService = useProjectService()\n\n// 已移除未使用的projectList计算属性\n\n// 生命周期\nonMounted(async () => {\n  await loadProjects()\n})\n\n// 加载项目列表\nconst loadProjects = async () => {\n  try {\n    const data = await projectService.getAllProjects()\n    projects.value = data\n    // 更新Vuex store\n    store.dispatch('setProjects', data)\n  } catch (error) {\n    console.error('加载项目列表失败:', error)\n    this.$message.error('加载项目列表失败')\n  }\n}\n\n// 查看项目\nconst viewProject = (id) => {\n  router.push({ name: 'projectDetail', params: { id } })\n}\n\n// 编辑项目\nconst editProject = (project) => {\n  isEditing = true\n  formData.value = { ...project }\n  showAddDialog.value = true\n}\n\n// 删除项目\nconst deleteProject = async (id) => {\n  try {\n    await projectService.deleteProject(id)\n    // 更新本地数据\n    projects.value = projects.value.filter(project => project.id !== id)\n    // 更新Vuex store\n    store.dispatch('deleteProjectById', id)\n    this.$message.success('项目删除成功')\n  } catch (error) {\n    console.error('删除项目失败:', error)\n    this.$message.error('删除项目失败')\n  }\n}\n\n// 提交表单\nconst submitForm = async () => {\n  try {\n    await formRef.value.validate()\n\n    if (isEditing) {\n      // 编辑项目\n      await projectService.updateProject(formData.value.id, formData.value)\n      // 更新本地数据\n      const index = projects.value.findIndex(project => project.id === formData.value.id)\n      if (index !== -1) {\n        projects.value[index] = { ...formData.value }\n      }\n      // 更新Vuex store\n      store.dispatch('updateProjectById', {\n        id: formData.value.id,\n        updatedData: formData.value\n      })\n      this.$message.success('项目更新成功')\n    } else {\n      // 添加项目\n      const newProject = await projectService.createProject(formData.value)\n      // 更新本地数据\n      projects.value.push(newProject)\n      // 更新Vuex store\n      store.dispatch('addProject', newProject)\n      this.$message.success('项目添加成功')\n    }\n\n    // 关闭对话框\n    showAddDialog.value = false\n    // 重置表单\n    resetForm()\n  } catch (error) {\n    console.error('提交表单失败:', error)\n    if (error.name === 'ValidationError') {\n      return\n    }\n    this.$message.error('操作失败，请重试')\n  }\n}\n\n// 重置表单\nconst resetForm = () => {\n  formRef.value.resetFields()\n  formData.value = {\n    id: '',\n    name: '',\n    description: '',\n    startDate: '',\n    endDate: '',\n    status: 'notStarted'\n  }\n  isEditing = false\n}\n</script>\n\n<style scoped>\n.project-admin-container {\n  padding: 20px;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.add-btn {\n  padding: 8px 16px;\n  background-color: #4096ff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.project-list {\n  background-color: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  padding: 20px;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}